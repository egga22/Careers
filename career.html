<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Career Profile</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="detail-body">
  <header class="top-bar">
    <h1>Career Profile</h1>
    <p class="subtitle">Quick view of the selected career.</p>
  </header>

  <main class="detail-layout">
    <section class="detail-card" id="detail-card">
      <p>Loading career information...</p>
    </section>
    <a class="back-link" href="index.html">← Back to map</a>
  </main>

  <script src="careers.js"></script>
  <script>
    const careers = window.careersData || [];
    const taxonomy = window.careerTaxonomy || { clusters: [] };

    function getCareerById(id) {
      return careers.find((career) => career.id === id);
    }

    function findClusterById(clusterId) {
      return taxonomy.clusters.find((cluster) => cluster.id === clusterId);
    }

    function findSectorById(sectorId) {
      return taxonomy.clusters
        .flatMap((cluster) => cluster.sectors.map((sector) => ({ ...sector, clusterId: cluster.id })))
        .find((sector) => sector.id === sectorId);
    }

    function formatCurrency(amount) {
      if (typeof amount !== "number" || Number.isNaN(amount)) {
        return "N/A";
      }
      return `$${amount.toLocaleString()}`;
    }

    function formatCurrencyRange(range) {
      return `${formatCurrency(range.low)} – ${formatCurrency(range.high)}`;
    }

    function buildLinkedInUrl(title) {
      const keywordQuery = encodeURIComponent(title).replace(/%20/g, "+");
      return `https://www.linkedin.com/jobs/search/?keywords=${keywordQuery}`;
    }

    function renderCareer() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const container = document.getElementById("detail-card");

      const career = getCareerById(id);
      if (!career) {
        container.innerHTML = `<h2>Career not found</h2><p>The selected career could not be located.</p>`;
        return;
      }

      const categoryList = career.categories
        .map((category) => {
          const cluster = findClusterById(category.clusterId);
          const sector = findSectorById(category.sectorId);
          return `${cluster?.name || category.clusterId} → ${sector?.name || category.sectorId} → ${category.industry}`;
        })
        .join("<br>");

      const salaryDistribution = career.salaryDistribution || {};

      container.innerHTML = `
        <h2>${career.name}</h2>
        <p class="muted">Median Salary</p>
        <p class="salary">${formatCurrency(career.medianSalary)}</p>
        <p class="muted">Salary Range</p>
        <p>${formatCurrencyRange(career.salaryRange)}</p>
        <p class="muted">Salary Distribution</p>
        <ul>
          <li>10th percentile: ${formatCurrency(salaryDistribution.tenthPercentile)}</li>
          <li>25th percentile: ${formatCurrency(salaryDistribution.twentyFifthPercentile)}</li>
          <li>Median: ${formatCurrency(salaryDistribution.median)}</li>
          <li>75th percentile: ${formatCurrency(salaryDistribution.seventyFifthPercentile)}</li>
          <li>90th percentile: ${formatCurrency(salaryDistribution.ninetiethPercentile)}</li>
        </ul>
        <p class="muted">Stress Level</p>
        <p>${career.stressLevel}</p>
        <p class="muted">Top Universities</p>
        <ul>
          ${career.topUniversities.map((school) => `<li>${school}</li>`).join("")}
        </ul>
        <p class="muted">LinkedIn Search</p>
        <p><a href="${buildLinkedInUrl(career.name)}" target="_blank" rel="noopener">Search ${career.name} jobs on LinkedIn</a></p>
        <p class="note">${categoryList}</p>
        <p class="note">More details will appear here as the database grows.</p>
      `;
    }

    renderCareer();
  </script>
</body>
</html>
