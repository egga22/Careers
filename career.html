<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Career Profile</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="detail-body">
  <header class="top-bar">
    <h1>Career Profile</h1>
    <p class="subtitle">Quick view of the selected career.</p>
  </header>

  <main class="detail-layout">
    <section class="detail-card" id="detail-card">
      <p>Loading career information...</p>
    </section>
    <a class="back-link" href="index.html">← Back to map</a>
  </main>

  <script src="careers.js"></script>
  <script>
    const careers = window.careersData || [];
    const taxonomy = window.careerTaxonomy || { clusters: [] };

    function getCareerById(id) {
      return careers.find((career) => career.id === id);
    }

    function findClusterById(clusterId) {
      return taxonomy.clusters.find((cluster) => cluster.id === clusterId);
    }

    function findSectorById(sectorId) {
      return taxonomy.clusters
        .flatMap((cluster) => cluster.sectors.map((sector) => ({ ...sector, clusterId: cluster.id })))
        .find((sector) => sector.id === sectorId);
    }

    function formatCurrency(amount) {
      return `$${amount.toLocaleString()}`;
    }

    function renderCareer() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const container = document.getElementById("detail-card");

      const career = getCareerById(id);
      if (!career) {
        container.innerHTML = `<h2>Career not found</h2><p>The selected career could not be located.</p>`;
        return;
      }

      const categoryList = career.categories
        .map((category) => {
          const cluster = findClusterById(category.clusterId);
          const sector = findSectorById(category.sectorId);
          return `${cluster?.name || category.clusterId} → ${sector?.name || category.sectorId} → ${category.industry}`;
        })
        .join("<br>");

      const salaryRangeText = career.salaryRange
        ? `${formatCurrency(career.salaryRange.min)} - ${formatCurrency(career.salaryRange.max)}`
        : "Coming soon";

      const salaryDistribution = career.salaryDistribution?.percentiles || {};
      const distributionList = Object.entries(salaryDistribution)
        .sort(([aKey], [bKey]) => Number(aKey) - Number(bKey))
        .map(
          ([percentile, value]) => `
            <li><span class=\"pill-label\">P${percentile}</span> ${formatCurrency(value)}</li>
          `
        )
        .join("");

      const universitiesList = (career.topUniversities || [])
        .map((school) => `<li class=\"pill\">${school}</li>`)
        .join("");

      container.innerHTML = `
        <div class="detail-top">
          <div>
            <h2>${career.name}</h2>
            <p class="note">${categoryList}</p>
          </div>
          <a class="action-link" href="${career.linkedinUrl}" target="_blank" rel="noopener noreferrer">Search on LinkedIn</a>
        </div>

        <div class="metric-grid">
          <div class="metric-card">
            <p class="muted">Median Salary</p>
            <p class="salary">${formatCurrency(career.medianSalary)}</p>
            <p class="note">Typical range: ${salaryRangeText}</p>
          </div>
          <div class="metric-card">
            <p class="muted">Stress Level</p>
            <p class="metric-highlight">${career.stressLevel}</p>
            <p class="note">Based on industry expectations.</p>
          </div>
          <div class="metric-card">
            <p class="muted">Salary Distribution</p>
            <ul class="pill-list">${distributionList}</ul>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <h3>Top Universities</h3>
            <p class="note">Programs commonly aligned with this career path.</p>
          </div>
          <ul class="pill-list">${universitiesList}</ul>
        </div>
      `;
    }

    renderCareer();
  </script>
</body>
</html>
